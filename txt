MAPSOFT2
----------------------------------------------------------------------

 1. Что это такое. Системные требования.
 2. Допущения при геодезических преобразованиях
 3. Ввод-вывод геоданных. Связь с gps-приемником. 
    Форматы OziExplorer, garmin-utils, xml
 4. Чтение и запись формата FIG3.2
 5. geofig
 6. Чтение и запись формата MP
----------------------------------------------------------------------

    1. Что это такое. Системные требования.

mapsoft2 - это набор библиотек и небольших программ для работы с
геоданными, растровыми и векторными картами и т.п. Никакой общей
концепции пока не существует, поэтому библиотеки и программы  весьма
разрозненны. 

Мы не ставим себе цель сделать серьезную ГИС-систему, а хотим 
решать простые бытовые задачи: смотреть треки и точки на картах,
делать векторные карты для туристского ориентироваия и т.п.

Для компиляции программ нужны следующие библиотеки: 
 * libusb - связь с gps-приемником через usb
 * boost/spirit - синтаксический разбор разных файлов и пр.
 * gtkmm-2.0 - графический интерфейс
 * libtiff, libjpeg, libpng - чтение соответствующих форматов.

Мы пишем программы под Linux. Кажется, их удавалось скомпилировать 
и под MacOS. Можно ли скомпилировать их под Windows - неясно, никаких
теоретических препятствий тому, кажется, нет.

----------------------------------------------------------------------

    2. Библиотека jeeps. Геодезические допущения и соглашения.

Геодезические преобразования, а также связь с gps-приемниками через usb
и rs232 происходит с помощью замечательной библиотеки jeeps. К
сожалению, в интернете ее удалось найти только как часть пакета
gpsbabel. Используется немного модифицированная версия библиотеки,
которая хранится в директории /jeeps. 

Все координаты хранятся в градусах WGS84. При этом, во всех объектах
данных x - это долгота, а у - широта!

Высота при преобразованиях СК не преобразуется.

Сейчас при работе с картами поддерживаются практически только
две проекции: равноугольная поперечно-цилиндрическая проекция 
Гаусса-Крюгера (transverse mercator, tmerc) и проекции Lon/Lat (lonlat).

При этом мы не храним информацию о системе координат в которой была
нарисована карта и о параметрах проекции ГК, считая, что замена этих
параметров с хорошей точностью является линейным преобразованием!

Таким образом, любое преобразование карты сводится к преобразованию
latlon->tmerc или обратному (если это нужно) и линейному преобразованию,
которое находится по точкам привязки (минимизацией среднеквадратичного
отклонения, если точек более трех). Координаты точек привязки конечно
же, следует преобразовывать честно, заботясь о правильных
преобразованиях систем координат и построений правильных проекций!

Замечательность такого подхода заключается в том, что для карт,
нарисованных в проекции Гаусса-Крюгера (а в большинстве случаев мы с
такими и работаем) нам необходимы только линейные
преобразования, что сильно убыстряет дело!

(написать про величину искажений из-за такого допущения)

----------------------------------------------------------------------

    Работа с геоданными. Проекция, система координат, 

----------------------------------------------------------------------

    3. Ввод-вывод геоданных. Связь с gps-приемником.
       Форматы OziExplorer, garmin-utils, xml

Геоданные - это треки, точки и привязнные карты, примерно в том смысле,
как они понимаются в OziExplorer. В файле geo_io/geo_data.h описаны следующие 
структуры данных:
 * g_point - точка, содержащая две вещественных координаты
 * g_waypoint - waypoint, поля примерно те же, что и в формате OziExplorer
 * g_trackpoint - точка трека, поля примерно те же, что и в формате OziExplorer
 * g_refpoint - точка привязки карты: g_point + две целочисленные координаты

 * g_waypoint_list - список точек
 * g_track - Трек. список g_trackpoint + информация о треке
 * g_map - Привязка карты. Список g_refpoint + информация о карте

...
----------------------------------------------------------------------

    4. Чтение и запись формата FIG3.2

FIG - удобный для многих целей текстовый формат векторной графики. Мы
используем его, в частности, для рисования векторных карт и схем.

В файле geo_io/fig.h описаны структуры данных fig_object и fig_world
и процедуры чтения и записи их в файл.

----------------------------------------------------------------------

    5. geofig

Чтобы хранить, смотреть и редактировать геоданные в формате fig было
придумано специальное расширение формата. Чтение и запись геоданных
в объект fig_world описана в файле geo_io/geofig.h

В комментарии к файлу может быть указан тип проекции, например
"proj: lonlat" По умолчанию проекция - tmerc

 * REF <x> <y>
 * WPT <name>
 * TRK <comment>
 * MAP <comment>
 * BRD <comment>


----------------------------------------------------------------------

 6. Чтение и запись формата MP

----------------------------------------------------------------------
